<!DOCTYPE html>

<html lang="es-es">

<head>
    <title>Planeta Zampa</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilo.css">

    <script>
        //CAMPOS GLOBALES
        var permiteSubmit = true;
        //var arrayErrores = [];

        //Comprueba que los inputs nombre, apellidos, nif, email, telefono, direccion, tarjeta, caducidad y codigo-seguridad no están vacíos.
        function compruebaCompleto() {
            var campoNombre = document.getElementById("fnombre").value.trim();
            var campoApellidos = document.getElementById("fapellidos").value.trim();
            var campoNif = document.getElementById("fnif").value.trim();
            var campoEmail = document.getElementById("femail").value.trim();
            var campoTelefono = document.getElementById("ftelefono").value.trim();
            var campoDireccion = document.getElementById("fdireccion").value.trim();
            var campoTarjeta = document.getElementById("ftarjeta").value.trim();
            var campoCaducidad = document.getElementById("fcaducidad").value.trim();
            var campoCodigo = document.getElementById("fcodigo").value.trim();
            if (campoNombre == "" || campoApellidos == "" || campoNif == "" || campoEmail == "" || campoTelefono == "" || campoDireccion == ""
                || campoTarjeta == "" || campoCaducidad == "" || campoCodigo == "") {
                alert("Por favor, rellene todos los campos.");
                return permiteSubmit = false;
            }
        }
        //Comprueba que el NIF tiene entre 4 y 9 dígitos seguidos de un guión y luego una letra. Para esto se puede usar regex. Ayudas  aquí debajo:
        //https://learnxinyminutes.com/docs/pcre/
        //https://regex101.com/
        function compruebaNif() {
            var campoNif = document.getElementById("fnif");
            _regexExp = /^\d{4,9}-[a-zA-Z]$/;
            if (!_regexExp.test(campoNif.value)) {
                alert("El NIF debe estar compuesto por entre 4 y 9 dígitos seguidos de un guión y una letra")
                campoNif.focus();
                return permiteSubmit = false;
            }
        }
        //Comprobación del correo de manera similar a la del NIF usando regex.
        function compruebaCorreo() {
            var campoEmail = document.getElementById("femail");
            _regexExp = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            if (!_regexExp.test(campoEmail.value)) {
                alert("Por favor, introduzca una dirección de correo electrónico válida.")
                campoEmail.focus();
                return permiteSubmit = false;
            }
        }
        //Comprobación del teléfono.
        function compruebaTelefono() {
            var campoTelefono = document.getElementById("ftelefono");
            _regexExp = /^\d{9}$/;
            if (!_regexExp.test(campoTelefono.value)) {
                alert("Por favor, introduzca un número de teléfono válido.")
                campoTelefono.focus();
                return permiteSubmit = false;
            }
        }
        //Comprobación de la fecha y hora de entrega.
        function compruebaFecha() {
            var _fechaActual = new Date();
            var _horaActual = _fechaActual.getTime();
            // a fecha entrega le tengo que dar un string dentro de new Date en plan new Date (año,mes,dia,hora,minutos,segundos). Vamos a parsear el input!
            var _fechaEntrega = document.getElementById("ffentrega").value;
            _fechaEntrega = _fechaEntrega.split("-");
            var _horaEntrega = document.getElementById("fhentrega").value;
            _horaEntrega = _horaEntrega.split(":");
            _m = _fechaEntrega.concat(_horaEntrega);
            _ano = _m[0];
            _mes = _m[1]-1;
            _dia = _m[2];
            _hora = _m[3];
            _minutos = _m[4];
            _momentoEntrega = new Date (_ano,_mes,_dia,_hora,_minutos);
            //var _momentoEntrega = new Date (_fechaEntrega,getHours(_horaEntrega),getMinutes(_horaEntrega));
            if (_momentoEntrega < _fechaActual) {
                alert("La fecha de entrega se encuentra en el pasado. ¡Ojalá pudiéramos viajar en el tiempo para entregar tu pedido! Pero de momento solo viajamos entre planetas");
                return permiteSubmit = false;
            }
        }


        // Cálculo de las calorias y precio total de la selección del usuario.
        function calcula() {
                //Se crean las variables para el total de calorias y precio para luego ir sumando, así como la cantidad de menús para limitar el recorrido del for.
                var total_calorias = 0;
                var total_precio = 0;
                menus =  document.getElementsByName("calorias");
                var cantidadDeMenus =menus.length; 
                //Ahora se navega por los elementos del formulario que contienen los datos que necesitamos y se extraen sus valores.
                for (let i = 0; i < cantidadDeMenus; i++) {
                    var caloria = document.getElementsByName("calorias").item(i).textContent;
                    var precio = document.getElementsByName("precio").item(i).textContent;
                    precio = parseFloat(precio);  // Con esto se convierte el precio con comas en un nº que separa los decimales con puntos.
                    var cantidad = document.getElementsByClassName("input-cantidad").item(i).value;
                    //Se actualizan las variables totales con los nuevos valores.
                    total_calorias = total_calorias + (caloria * cantidad);
                    total_precio = total_precio + (precio * cantidad);
                }
                //Mensaje para informar al usuario. Se reemplazan los puntos del float del precio por comas.
                total_precio = total_precio.toString().replace(/\./g, ',');
                alert("Su selección contiene:\n" + total_calorias + " kcal\n\n y tiene un precio total de:\n" + total_precio + " €.");
            }


            ////////////////////////////////////////////////////////////////////////////////
            //PRUEBAS
            /*function compruebaCampo(_campo) {
                _objeto = document.getElementById(_campo).value.trim();
                if (_objeto == "") {
                    permiteSubmit = false;
                    arrayErrores.push(_objeto);
                    return _objeto;
                }
    
                switch (_campo) {
                    case "fnif":
                        if (!(/^\d{4,9}-[a-zA-Z]$/.test(_campo))) {
                            alert("El NIF debe estar compuesto por entre 4 y 9 dígitos seguidos de un guión y una letra")
                            return permiteSubmit = false;
                        }
                        break;
    
                    case "fcorreo":
    
                        break;
    
                    default:
                        Console.log("Caso no capturado: " + _campo);
                        break;
                }
    
                ud(_campo == "fnif"){
    
                }
                return _objeto
            }
    
            //PRUEBAS PARA HACERLO DE OTRA FORMA
            function compruebaCampos() {
                var campoNombre = compruebaCampo("fnombre");
                var campoApellidos = compruebaCampo("fapellidos");
                var campoNif = compruebaCampo("fnif");
                var campoEmail = compruebaCampo("f");
                var campoTelefono = compruebaCampo();
                var campoDireccion = compruebaCampo();
                var campoTarjeta = compruebaCampo();
                var campoCaducidad = compruebaCampo();
                var campoCodigo = compruebaCampo();
                if (permiteSubmit == false) {
                    alert("Por favor, rellene todos los campos.");
                }
            }*/
            ////////////////////////////////////////////////////////////////////////////////
    </script>
</head>

<body>
    <div class="contenedor">
        <p>En <span style="font-weight: bold; font-size: larger;">PLANETA ZAMPA</span> queremos llevar a tu puerta
            comida tan buena que pienses que es de otro mundo.<br>
            ¿Ya sabes qué te gustaría comer? ¡Dínoslo y rellena tus datos en el formulario! Nosotros nos encargamos del
            resto y en un rato recibiras en tu propia casa platos elaborados de manera
            tradicional y tan buenos que creeras que vienen de otro planeta.</p>
        <div class="form">
            <form action="mailto:rjimenez591@alumno.uned.es" method="POST" enctype="text/plain" id="form1"
                onsubmit="return permiteSubmit">
                <fieldset>
                    <legend>Menús</legend>
                    <label>Menú 1: Salteado de legumbres a la plancha + Bistec con patatas fritas + Refresco - <span
                            name="calorias">950</span> kcal
                        - <span name="precio">13</span> €</label><br>
                    <input type="number" min="0" max="100" name="menu1" class="input-cantidad"><br>
                    <label>Menú 2: Salteado de verduras con arroz + Salmón al horno con espárragos y puré de patata +
                        Refresco - <span name="calorias">950</span> kcal - <span name="precio">12</span> €</label><br>
                    <input type="number" min="0" max="100" name="menu2" class="input-cantidad"><br>
                    <label>Menú 3: Sepia salteada con verduritas + Salchicha alemana al horno + Refresco - <span
                            name="calorias">950</span> kcal - <span name="precio">13</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="menu3" class="input-cantidad"><br>
                    <label>Menú 4: Esparragos a la plancha con jamón + Boquerones fritos al limón + Refresco - <span
                            name="calorias">850</span> kcal
                        - <span name="precio">13</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="menu4" class="input-cantidad"><br>
                    <label>Menú 5: Guisantes con jamón y huevo + Pollo asado con verduras salteadas + Refresco - <span
                            name="calorias">950
                        </span> kcal - <span name="precio">13</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="menu5" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Verduras</legend>
                    <label>Salteado de legumbres a la plancha - <span name="calorias">250</span> kcal -
                        <span name="precio">5</span> €</label><br>
                    <input type="number" min="0" max="100" name="salteado-legumbres" class="input-cantidad"><br>
                    <label>Salteado de verduras con arroz - <span name="calorias">450</span> kcal - <span
                            name="precio">6</span> €</label><br>
                    <input type="number" min="0" max="100" name="salteado-verduras" class="input-cantidad"><br>
                    <label>Sepia salteada con verduritas - <span name="calorias">400</span> kcal - <span
                            name="precio">7</span> €</label><br>
                    <input type="number" min="0" max="100" name="sepia" class="input-cantidad"><br>
                    <label>Espárragos a la plancha con jamón - <span name="calorias">250</span> kcal - <span
                            name="precio">5</span> €</label><br>
                    <input type="number" min="0" max="100" name="esparragos" class="input-cantidad"><br>
                    <label>Guisantes con jamón y huevo - <span name="calorias">350</span> kcal - <span
                            name="precio">6</span> €</label><br>
                    <input type="number" min="0" max="100" name="guisantes" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Carnes</legend>
                    <label>Bistec con patatas fritas - <span name="calorias">650</span> kcal - <span
                            name="precio">8</span> €</label><br>
                    <input type="number" min="0" max="100" name="bistec" class="input-cantidad"><br>
                    <label>Pollo asado con verduras salteadas - <span name="calorias">550</span> kcal - <span
                            name="precio">6</span> €</label><br>
                    <input type="number" min="0" max="100" name="pollo" class="input-cantidad"><br>
                    <label>Costillas a la barbacoa - <span name="calorias">650</span> kcal - <span
                            name="precio">7</span> €</label><br>
                    <input type="number" min="0" max="100" name="costillas" class="input-cantidad"><br>
                    <label>Salchicha alemana al horno - <span name="calorias">450</span> kcal - <span
                            name="precio">5</span> €</label><br>
                    <input type="number" min="0" max="100" name="salchicha" class="input-cantidad"><br>
                    <label>Alitas de pollo en salsa agridulce - <span name="calorias">450</span> kcal - <span
                            name="precio">6</span> €</label><br>
                    <input type="number" min="0" max="100" name="alitas" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Pescados</legend>
                    <label>Lubina al horno en salsa de lima con romero y espárragos - <span name="calorias">450</span>
                        kcal - <span name="precio">5</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="lubina" class="input-cantidad"><br>
                    <label>Dorada al horno con patatas panaderas - <span name="calorias">500</span> kcal - <span
                            name="precio">6</span> €</label><br>
                    <input type="number" min="0" max="100" name="dorada" class="input-cantidad"><br>
                    <label>Boquerones fritos al limón - <span name="calorias">550</span> kcal - <span
                            name="precio">7</span> €</label><br>
                    <input type="number" min="0" max="100" name="boquerones" class="input-cantidad"><br>
                    <label>Salmón al horno con espárragos y puré de patata - <span name="calorias">450</span> kcal -
                        <span name="precio">5</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="salmón" class="input-cantidad"><br>
                    <label>Medallones de merluza a la plancha con tomate - <span name="calorias">400</span> kcal - <span
                            name="precio">6</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="merluza" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Postres</legend>
                    <label>Crema de yogur con fresas - <span name="calorias">450</span> kcal - <span
                            name="precio">2,50</span> €</label><br>
                    <input type="number" min="0" max="100" name="yogur" class="input-cantidad"><br>
                    <label>Pudin casero - <span name="calorias">500</span> kcal - <span name="precio">2,50</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="pudin" class="input-cantidad"><br>
                    <label>Queso fresco con miel y nueces - <span name="calorias">250</span> kcal - <span
                            name="precio">1,50</span> €</label><br>
                    <input type="number" min="0" max="100" name="queso" class="input-cantidad"><br>
                    <label>Tarta marmol rosa - <span name="calorias">600</span> kcal - <span name="precio">3,50</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="tarta" class="input-cantidad"><br>
                    <label>Copa de helado de varios sabores - <span name="calorias">600</span> kcal - <span
                            name="precio">3</span> €</label><br>
                    <input type="number" min="0" max="100" name="helado" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Bebidas</legend>
                    <label>Vino de la casa - <span name="calorias">50</span> kcal - <span name="precio">5</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="vino" class="input-cantidad"><br>
                    <label>Refresco - <span name="calorias">50</span> kcal - <span name="precio">2,50</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="refresco" class="input-cantidad"><br>
                    <label>Agua mineral - <span name="calorias">0</span> kcal - <span name="precio">1,50</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="agua" class="input-cantidad"><br>
                    <label>Cerveza - <span name="calorias">50</span> kcal - <span name="precio">2</span> €</label><br>
                    <input type="number" min="0" max="100" name="cerveza" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <legend>Extras</legend>
                    <label>Pan - <span name="calorias">200</span> kcal - <span name="precio">1</span> €</label><br>
                    <input type="number" min="0" max="100" name="pan" class="input-cantidad"><br>
                    <label>Ensalada mixta - <span name="calorias">100</span> kcal - <span name="precio">2,50</span>
                        €</label><br>
                    <input type="number" min="0" max="100" name="ensalada" class="input-cantidad"><br>
                </fieldset>
                <fieldset>
                    <label>Observaciones adicionales:</label><br>
                    <input type="text" name="Observaciones" style="width: 500px; height: 25px;"><br>
                    <label>Fecha y hora de entrega</label><br>
                    <input type="date" name="fecha-entrega" id="ffentrega">
                    <input type="time" name="hora-entrega" min="13:00" max="00:00" id=fhentrega>
                </fieldset>
                <fieldset>
                    <legend>Datos personales</legend>
                    <table>
                        <tr>
                            <td>Nobre:</td>
                            <td><input type="text" name="nombre" id="fnombre" required></td>
                        </tr>
                        <tr>
                            <td>Apellidos:</td>
                            <td><input type="text" name="apellidos" id="fapellidos" required></td>
                        </tr>
                        <tr>
                            <td>NIF:</td>
                            <td><input type="text" name="nif" id="fnif" required></td>
                        <tr>
                            <td>Correo electrónico:</td>
                            <td><input type="text" name="email" id="femail" required></td>
                        </tr>
                        <tr>
                            <td>Teléfono:</td>
                            <td><input type="text" name="telefono" id="ftelefono" required></td>
                        </tr>
                        <tr>
                            <td>Dirección de entrega:</td>
                            <td><input type="text" name="direccion" id="fdireccion" required></td>
                        </tr>
                        <tr>
                            <td>Tarjeta bancaria:</td>
                            <td><input type="text" name="tarjeta" id="ftarjeta" required></td>
                        </tr>
                        <tr>
                            <td>Caducidad:</td>
                            <td><input type="text" name="caducidad" id="fcaducidad" required></td>
                        </tr>
                        <tr>
                            <td>Código de seguridad:</td>
                            <td><input type="text" name="codigo-seguridad" id="fcodigo" required></td>
                        </tr>
                    </table>
                </fieldset>
                <input type="reset">
                <input type="submit" value="Hacer pedido" onclick="permiteSubmit=true;compruebaCompleto(); compruebaNif();compruebaCorreo();compruebaTelefono();compruebaFecha();">
            </form>
            <button value="calcular" onclick="calcula()">Calcula las kcal y precio de tu pedido</button>
        </div>
    </div>
</body>

</html>